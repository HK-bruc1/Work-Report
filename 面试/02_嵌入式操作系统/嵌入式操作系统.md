# SMP

## 什么叫SMP

在嵌入式领域中，SMP是指一种对称多处理器架构，在该架构中，多个CPU共享同一个内存和I/O设备，并且所有CPU具有相同的权限和对称性（CPU都是相同的）。

## 有什么特点

- 多个CPU共享同一物理内存，每个CPU访问相同的地址空间
- 所有的CPU权限相同，可均衡的调度任务，没有主从之分。
- 多个CPU通过共享的缓存一致性协议保持数据同步，防止数据不一致问题。
- 任务可以在不同CPU之间动态调度，提高CPU资源利用率。
- 单个操作系统控制多个相同的CPU，实现负载均衡。

## 工作中的体现

比如我们耳机中的JL7016G，JL7096D这些新芯片有一些都是双核的。一般双核的性能要好些，比如心率检测功能在AC710N单核芯片上会跑不动出现复位现象，但是在双核的芯片下运行是没有问题的。

# FreeRTOS和RT-Thread的区别

这两个工作上接触的不多，他们都是开源的硬实时轻量级操作系统，FreeRTOS在国际上更加普遍，生态更加丰富以及解决方案比较成熟，之前有在STM32上使用过，主要是体验一下多线程并发，感受下裸机和库函数开发的差别。RT-Thread是国产的，之前看过官方文档，有较好的 POSIX 接口，移植到Linux比较方便。我接触的比较多的是zephyr，这个是Linux基金会推出的轻量级操作系统。当初接触他的原因是他的构建和编码不依赖于厂商，比如STM32还需要下对应的开发包。初始化还需要对应cubemx工具，太麻烦。而zephyr它硬件和软件是解耦的，硬件统一通过设备树DTS文件描述。而且zephyr支持的架构，SOC，开发板比较多。程序移植芯片和开发板比较方便。只需要修改DTS即可。

# 什么是原子操作

不可被打断、不可分割、对外表现为“瞬间完成”的操作。在多线程/多核环境下，对共享内存的某个操作（或一组紧密相关的操作）从其他所有线程/处理器看来，要么完全没发生，要么已经完整执行完毕，不存在“执行到一半”的中间状态。

## 工作中体现

比如我在切换ANC时，提示音没有报完，流程没有走完。这时我再切换一次ANC，就会触发锁存机制（互斥机制），那么ANC的状态还是上一次流程结束时的状态，这个操作就是原子性的，中途不能被打断。



