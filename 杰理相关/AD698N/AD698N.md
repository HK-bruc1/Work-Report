# 公版问题

## 烧录

### 返回KEYERR

- 需要加一个`141-AMW-AC690X-41C3.key`文件
- `download.bat`中

```c
..\..\isd_download.exe ..\..\isd_config.ini -tonorflash -dev br34 -boot 0x20000 -div8 -wait 300 -uboot ..\..\uboot.boot -app ..\..\app.bin -res cfg_tool.bin tone.cfg p11_code.bin eq_cfg_hw.bin -uboot_compress      -key   141-AMW-AC690X-41C3.key
```

### 返回芯片信息不匹配

![image-20250618094837865](./AD698N.assets/image-20250618094837865.png)

`apps\earphone\board\br34\board_ad698x_demo_global_build_cfg.h`

```c
#define CONFIG_PID                              TWS//AD698N              //烧写或强制升级之前可以修改,之后升级要保持一致
```

## 触摸按键不能使用

`apps\earphone\board\br34\board_ad698x_demo_cfg.h`

```c
#define TCFG_USER_TWS_ENABLE                      1   //tws功能使能

//*********************************************************************************//
//                             lp tocuh key 配置                                   //
//*********************************************************************************//
#define TCFG_LP_TOUCH_KEY_ENABLE 		   CONFIG_LP_TOUCH_KEY_EN  //是否使能触摸按键
#define TCFG_LP_TOUCH_KEY0_EN               1                           //是否使能触摸按键0 —— PB0
#define TCFG_LP_TOUCH_KEY1_EN               0                           //是否使能触摸按键1 —— PB2
```

`CONFIG_LP_TOUCH_KEY_EN`没使能

`apps\earphone\board\br34\board_ad698x_demo_global_build_cfg.h`

```c
#define CONFIG_LP_TOUCH_KEY_EN					1//0		//配置是否使用内置触摸
```

## 功能正常但是灯效没有

![image-20250618151354499](./AD698N.assets/image-20250618151354499.png)

可能硬件配置选择有问题：

`apps\earphone\board\br34\board_ad698x_demo_cfg.h`

```c
//*********************************************************************************//
//                                  LED 配置                                       //
//*********************************************************************************//
#define TCFG_PWMLED_ENABLE					DISABLE_THIS_MOUDLE			//是否支持PMW LED推灯模块
#define TCFG_PWMLED_IOMODE					LED_ONE_IO_MODE				//LED模式，单IO还是两个IO推灯
#define TCFG_PWMLED_PIN						IO_PORTB_06					//LED使用的IO口
```

LED是接的是PIN14针脚，不一定是IO口14。具体看芯片数据手册

- **查到对应的IO口还是不行**，立项出现了问题。
- `IO_PORTB_06`正确，打开`TCFG_PWMLED_ENABLE`即可

# 硬件配置

- 选择对应的板级文件配置
  - `apps\earphone\board\br34\board_config.h`
- 硬件的具体选择以及模块使能
  - `apps\earphone\board\br34\board_ad698x_demo_cfg.h`
  - `apps\earphone\board\br34\board_ad698x_demo_global_build_cfg.h`
- 硬件的功能配置与实现
  - `apps\earphone\board\br34\board_ad698x_demo.c`

# 读取配置文件还是硬编码

**是否使用配置工具的参数配置，默认蓝牙、通话、状态、音量是使用配置工具的参数，如果有其他需要可按需设置**

`apps\earphone\user_cfg.c`公版也是这么选择？

```c
#define USE_CONFIG_BIN_FILE                  0

#define USE_CONFIG_STATUS_SETTING            1                          //状态设置，包括灯状态和提示音
#define USE_CONFIG_AUDIO_SETTING             USE_CONFIG_BIN_FILE        //音频设置
#define USE_CONFIG_CHARGE_SETTING            USE_CONFIG_BIN_FILE        //充电设置
#define USE_CONFIG_KEY_SETTING               USE_CONFIG_BIN_FILE        //按键消息设置
#define USE_CONFIG_MIC_TYPE_SETTING          USE_CONFIG_BIN_FILE        //MIC类型设置
#define USE_CONFIG_LOWPOWER_V_SETTING        USE_CONFIG_BIN_FILE        //低电提示设置
#define USE_CONFIG_AUTO_OFF_SETTING          USE_CONFIG_BIN_FILE        //自动关机时间设置
#define USE_CONFIG_COMBINE_VOL_SETTING       1					        //联合音量读配置
```

## USE_CONFIG_STATUS_SETTING

只在一个地方使用：`apps\earphone\user_cfg.c`

`cfg_file_parse`函数中

```c
#if USE_CONFIG_STATUS_SETTING
    /* g_printf("status_config:"); */
    log_info("status_config:");
    STATUS_CONFIG *status = (STATUS_CONFIG *)tmp;
    ret = syscfg_read(CFG_UI_TONE_STATUS_ID, status, sizeof(STATUS_CONFIG));
    if (ret > 0) {
        memcpy((u8 *)&status_config, (u8 *)status, sizeof(STATUS_CONFIG));
        log_info_hexdump(&status_config, sizeof(STATUS_CONFIG));
    }
#endif
```



## USE_CONFIG_COMBINE_VOL_SETTING

